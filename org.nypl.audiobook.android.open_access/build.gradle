apply plugin: 'kotlin'
apply plugin: 'java-library'

dependencies {
  api project(':org.nypl.audiobook.android.api')

  implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
  implementation 'org.slf4j:slf4j-api:1.7.25'
  implementation 'com.google.android.exoplayer:exoplayer:r1.5.15'
}

/*
 * Generate a properties file based on various settings.
 */

task generatePropertiesResources {

  def directory = new File(project.projectDir, "src/main/resources/org/nypl/audiobook/android/open_access").absoluteFile
  directory.mkdirs()
  def file = new File(directory, "provider.properties")
  file.createNewFile()

  def properties = new Properties()
  def major = version.split("\\.").getAt(0)
  def minor = version.split("\\.").getAt(1)
  def patch = version.split("\\.").getAt(2)
  properties.setProperty("version.major", major)
  properties.setProperty("version.minor", minor)
  properties.setProperty("version.patch", patch)
  properties.store(new FileOutputStream(file), "Automatically generated - DO NOT EDIT")
}

compileKotlin.dependsOn generatePropertiesResources

jar {
  manifest {
    attributes(
      "Specification-Title": project.name,
      "Specification-Vendor": "NYPL",
      "Specification-Version": version,
      "Sealed": true
    )
  }
}

repositories {
  mavenCentral()
}

compileKotlin {
  kotlinOptions.jvmTarget = "1.6"
}

compileTestKotlin {
  kotlinOptions.jvmTarget = "1.6"
}
